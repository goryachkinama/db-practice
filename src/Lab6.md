---
title: Лабораторная работа 6. Соединение таблиц и группировка
---

[Таблицы студентов](assets/Students.xlsx)

[К списку лабораторных >>>](../README.md)

---

[Ссылка на лекцию по проектированиию](%D0%9B%D0%B5%D0%BA%D1%86%D0%B8%D1%8F%20%E2%84%966.%20%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5%20%D1%8D%D1%82%D0%B0%D0%BF%D1%8B%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%B1%D0%B0%D0%B7%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20%D0%BA%D0%BE%D0%BD%D1%86%D0%B5%D0%BF%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F%20(%D0%B8%D0%BD%D1%84%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F)%20%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20%D0%B8%20%D0%B4%D1%80..pptx)

[Описание требований к демо-экзамену](assets/lab/demo-exam.md)

[Проектирование БД](assets/lab/erd-scheme.md)

---

### Задание на проектирование и создание связанных таблиц

По [варианту 2](assets/lab/v2.md)

1. Построить ER-диаграмму
2. Построить логическую модель данных
3. Создать сущности в БД
4. Импортировать в них данные
5. Создать запросы, указанные ниже

---

### Запросы для таблиц из демо-экзамена. Вариант 2

1. Показ клиентов, у которых день рождения будет в текущем месяце
2. Показ клиентов с днями рождения по месяцам с промежуточным итогом, сколько человек в каждом месяце
3. Показ клиентов со следующими полями: ФИО, email, телефон, пол
4. Показ клиентов и список их тегов в соседнем столбце через запятую
5. Показ клиентов и количество их посещений и количество прикрепленных файлов
6. Вывести информацию по тегам: название и какой сколько раз используется, отсортировать от самого частого к самому редкому

---

### Задание по таблице студентов

1. Вывести из таблиц «Кафедра», «Специальность» и «Студент» данные о студентах, которые обучаются на данном факультете (например, «фит»).
2. Вывести из таблиц «Кафедра», «Специальность» и «Сотрудник» данные о выпускающих кафедрах
   (факультет, шифр, название, фамилию заведующего). Выпускающей считается та кафедра, на которую есть ссылки в таблице «Специальность».
3. Вывести в запросе для каждого сотрудника номер и фамилию его непосредственного руководителя.
   Для заведующих кафедрами поле руководителя оставить пустым.
4. Вывести список студентов, сдавших минимум два экзамена.
5. Вывести список инженеров с зарплатой, меньшей 20000 руб.
6. Вывести список студентов, сдавших экзамены в заданной аудитории.
7. Вывести из таблиц «Студент» и «Экзамен» учетные номера и фамилии студентов, а также количество сданных экзаменов
    и средний балл для каждого студента только для тех студентов, у которых средний балл не меньше заданного (например, 4).
8. Вывести список заведующих кафедрами и их зарплаты, и степень.
9. Вывести список профессоров.
10. Вывести название дисциплины, фамилию, должность и степень преподавателя, дату и место проведения экзаменов
    в хронологическом порядке в заданном интервале даты.
11. Вывести фамилию преподавателей, принявших более трех экзаменов.
12. Вывести список студентов, не сдавших ни одного экзамена в указанной дате.


---

### Соединение таблиц и группировка

Данные часто хранятся в несколько связанных таблицах. Для выбора данных использу-
ются разные методы соединения таблиц.
Когда выбор данных осуществляется из нескольких таблиц, в конструкции SELECT для
каждого поля указывается таблица в виде <таблица>.<поле>. Если название поля уникальное,
то можно его указать без таблицы, иначе это обязательно, чтобы избежать коллизий. Чтобы не
повторить длинные названия таблиц, можно использовать псевдоним для таблиц. Псевдоним
указывается в конструкции как FROM.

---

### Проектирование и создание связанных таблиц

Этапы проектирования
Нормализация

---

### [Неявное соединение таблиц](https://metanit.com/sql/sqlserver/7.1.php)

При неявном соединении таблиц формат конструкций FROM и WHERE имеет следующий вид:

```sql
FROM <таблица1> [псевдоним1], <таблица2> [псевдоним2]…
[WHERE <условие_соединения> [AND <условие_поиска>]… ]
```

Таким образом, если более одной таблицы присутствует в конструкции FROM, то их разделяют запятой.

Если условие соединения не указывать, тогда результат будет декартовым произведением, 
то есть для каждой строки одной из таблиц берутся все возможные сочетания строк из других таблиц.

Пример 1: Выбрать факультет и кафедры, используя неявное соединение. Результат отсортировать по алфавиту:

```sql
SELECT
Ф.Название AS Факультет
, К.Название AS Кафедра
FROM
Факультет Ф, Кафедра К
WHERE
Ф.Аббревиатура = К.Факультет
ORDER BY
Факультет, Кафедра
```

---

### Явное соединение таблиц

Для явного соединения таблиц используется команда JOIN. У явного соединения есть
следующие разновидности:

* Внутреннее соединение INNER JOIN
* Внешнее соединение OUTER JOIN (LEFT | RIGHT | FULL)
* Перекрестное соединение CROSS JOIN
  
---

#### [Внутреннее соединение таблиц: INNER JOIN] (https://metanit.com/sql/sqlserver/7.2.php)

Внутреннее соединение – осуществляется с помощью команды INNER JOIN.
Из двух таблиц берутся только связанные строки.

INNER JOIN имеет следующий формат записи:

```sql
<таблица1> INNER JOIN <таблица2> ON <таблица1>.<связующее_поле> = <таблица2>.<связующее_поле>.
```

При внутреннем соединении слово INNER можно пропустить

Пример 2: Выбрать факультет и кафедры, используя явное соединение. Результат отсортировать по алфавиту:

```sql
SELECT
Ф.Название AS Факультет
, К.Название AS Кафедра
FROM
Факультет Ф
INNER JOIN Кафедра К ON Ф.Аббревиатура = К.Факультет
ORDER BY
Факультет, Кафедра
```
---

#### [Внешнее соединение таблиц: OUTER JOIN (LEFT | RIGHT | FULL)](https://metanit.com/sql/sqlserver/7.3.php)

Внешнее соединение – осуществляется с помощью команды OUTER JOIN. 

OUTER JOIN имеет следующий формат записи:

```sql
<таблица1> LEFT | RIGHT | FULL OUTER JOIN <таблица2> ON <таблица1>.<связующее_поле> = <таблица2>.<связующее_поле>.
```

У внешнего соединения есть три разновидности:

* Левое внешнее соединение LEFT OUTER JOIN – из таблицы, название которой является левым операндом команды JOIN,
  выбираются все строки, из второй таблицы – только те записи, которые имеют связь с первой таблицей.
* Правое внешнее соединение RIGHT OUTER JOIN – из таблицы, название которой является правым операндом команды JOIN,
  выбираются все строки, из первой таблицы только те записи, которые имеют связь со второй таблицей.
* Полное внешнее соединение FULL OUTER JOIN – из обоих таблиц выбираются все строки.

При использовании внешних соединений, слово OUTER можно пропустить.

Пример 3: Выбрать все факультеты и их кафедры, если существуют. Результат отсортировать по алфавиту:
```sql
SELECT
Ф.Название AS Факультет
, К.Название AS Кафедра
FROM
Факультет Ф
LEFT OUTER JOIN Кафедра К ON Ф.Аббревиатура = К.Факультет
ORDER BY
Факультет, Кафедра
```
---

### [Перекрестное соединение CROSS JOIN](https://metanit.com/sql/sqlserver/7.3.php)

Перекрестное соединение CROSS JOIN – декартово произведение двух таблиц.

CROSS JOIN имеет следующий формат записи:

```sql
<таблица1> CROSS JOIN <таблица2>.
```

При выборе данных из трех и более таблиц, с помощью явного соединения, результат зависит от порядка соединения.

---

### Соединения таблиц со своей копией

Используя соединение, можно связать таблицу с собой. При таком соединении псевдоним обязателен.

---

### [Группировка в соединениях](https://metanit.com/sql/sqlserver/7.4.php)

Набор данных, полученных из нескольких таблиц, не отличается от набора, полученного из одной таблицы.
Ему тоже можно применить группировки и т.д.

---
