---
Команда SELECT: Лабораторная работа
---

[Таблица академиков](assets/lab2/Академики.xlsx)

[К списку лабораторных >>>](../README.md)

---

### Часть 1. 12 заданий по академикам

1. Вывести ФИО, специализацию и дату рождения всех академиков.
2. Создать вычисляемое поле «О присвоении звания», которое содержит информацию
   об академиках в виде: «Петров Петр Петрович получил звание в 1974».
3. Вывести ФИО академиков и вычисляемое поле «Через 5 лет после присвоения звания».
4. Вывести список годов присвоения званий, убрав дубликаты.
5. Вывести список академиков, отсортированный по убыванию даты рождения.
6. Вывести список академиков, отсортированный в обратном алфавитном порядке
   специализаций, по убыванию года присвоения звания, и в алфавитном порядке ФИО.
7. Вывести первую строку из списка академиков, отсортированного в обратном алфавитном порядке ФИО.
8. Вывести фамилию академика, который раньше всех получил звание.
9. Вывести первые 10% строк из списка академиков, отсортированного в алфавитном порядке ФИО.
10. Вывести из таблицы «Академики», отсортированной по возрастанию года присвоения звания, 
    список академиков, у которых год присвоения звания – один из первых шести в отсортированной таблице.
11. Вывести, начиная с десятого, список академиков, отсортированный по возрастанию даты рождения.
12. Вывести девятую и десятую строку из списка академиков, отсортированного в алфавитном порядке ФИО.

---

### Часть 2. Задания для своих таблиц

* составить 5 запросов с командой select и блоком from
* !составить 5 запросов с командой select и вычисляемыми столбцами
* составить 3 запроса с командой select, используя ключевое слово для отброса строк дубликатов
* составить по одному запросу для каждой из конструкиций: ORDER BY, TOP, PERCENT, OFFSET, FETCH
* !составить 3 запроса с записью данных в новую таблицу
* !составить 3 запроса с сортировкой по вычисляемому значению

---

### Команда SELECT

Для выборки данных из БД используется запрос SELECT.
Он позволяет фильтровать выбранные данные и преобразовать их к нужному виду. 
Результатом выполнения запроса SELECT является другая таблица, к которой снова может быть применен запрос SELECT

Основные предложения инструкции SELECT

```sql
[ WITH { [ XMLNAMESPACES ,] [ <common_table_expression> ] } ]
SELECT select_list [ INTO new_table ]
[ FROM table_source ]
[ WHERE search_condition ]
[ GROUP BY group_by_expression ]
[ HAVING search_condition ]
[ ORDER BY order_expression [ ASC | DESC ] ]
```

Обработка элементов запроса SELECT выполняется в следующей последовательности:

1. FROM – определяет имена используемых таблиц;
2. WHERE – фильтрует строки таблицы в соответствии с заданными условиями;
3. GROUP BY – группирует строки, имеющие одинаковые значения в указанном столбце;
4. HAVING – фильтрует группы строк в соответствии с указанным условием;
5. SELECT – форматирует выходные данные;
6. ORDER BY – сортирует результаты выполнения запроса.
   Порядок предложений в запросе SELECT не может быть изменен. Предложения SELECT и FROM являются обязательными, 
   присутствие остальных зависит от контекста.

---

### Изучение основ выборки данных

В предложении SELECT указывается список столбцов, которые должны быть возвращены запросом.
Можно указать исходные элементы или вычисляемые поля во время выполнения запроса.
Инструкция ALL используется по умолчанию.

\* означает вывод всех столбцов указанной таблицы.

* Пример 1: Вывести список академиков:

```sql
SELECT
*
FROM
Академики
```

Получение всех столбцов с помощью символа звездочки * считается не очень хорошей практикой, 
так как, как правило, не все столбцы бывают нужны. 
И более оптимальный подход заключается в указании всех необходимых столбцов после слова SELECT.

* Пример 2: Вывести ФИО и дату рождения всех академиков:

```sql
SELECT
ФИО, Дата_рождения
FROM
Академики
```

В случае, если выборка производится из нескольких таблиц, перед символом звездочки может указываться имя таблицы. 


Спецификация столбца необязательно должна представлять его название.
SQL-запрос может содержать вычисляемые столбцы, значения которых могут определятся на основе значений данных, 
хранящихся в БД конструкции.
Это может быть любое выражение, например, результат арифметической операции. Так, выполним следующий запрос:

```sql
SELECT ProductName + ' (' + Manufacturer + ')', Price, Price * ProductCount
FROM Products
```

Здесь при выборке будут создаваться три столбца:

* Первый столбец представляет результат объединения двух столбцов ProductName и Manufacturer. 
* Второй столбец - стандартный столбец Price. 
* А третий столбец представляет значение столбца Price, умноженное на значение столбца ProductCount.

Вычисляемым столбцам следует давать название с помощью ключевого слова AS. 

Вычисляемый столбец можно создать как: <Новое поле> = <выражение>

Если название столбца состоит из нескольких слов, разделенных пробелами, следует их записать в квадратных скобках: [].

* Пример 3: Создайте вычисляемое поле «Информация», содержащее информацию об академиках в таком виде: 
  «Академик Петров Петр Петрович, специализация: математика»:

```sql
SELECT
'Академик ' + ФИО + ', специализация: ' + Специализация AS Информация
FROM
Академики
```

* Пример 4: Вывести ФИО академиков и номер следующего года после присвоения звания:

```sql
SELECT
ФИО
,[Через год] = Год_присвоения_звания + 1
FROM
Академики
```

! Обратите внимание, что в предыдущем примере запятая ставится в начале строки. Это делается для удобства комментирования строк.

---

### Изучение конструкции DISTINCT | ALL

Конструкция DISTINCT | ALL исключает / разрешает вывод повторяющихся строк.
Конструкция ALL используется по умолчанию.

* Пример 5: Выведите список специализаций, убрав дубликаты:

```sql
SELECT DISTINCT
Специализация
FROM
Академики
```

---

### Выражение SELECT INTO

Выражение SELECT INTO позволяет выбрать из одной таблицы некоторые данные в другую таблицу, 
при этом вторая таблица создается автоматически. Например:

```sql
SELECT ProductName + ' (' + Manufacturer + ')' AS ModelName, Price
INTO ProductSummary
FROM Products

SELECT * FROM ProductSummary
```

После выполнения этой команды в базе данных будет создана еще одна таблица ProductSummary, 
которая будет иметь два столбца ModelName и Price, а данные для этих столбцов будут взяты из таблицы Products.
При выполнении этой команды таблица, в которую идет выборка (в данном случае ProductSummary), 
НЕ должна существовать в базе данных.

К примеру, после мы решили добавить все данные из таблицы Products в уже существующую таблицу ProductSummary. 
В этом случае можно использовать уже известную команду INSERT:

```sql
INSERT INTO ProductSummary
SELECT ProductName + ' (' + Manufacturer + ')' AS ModelName, Price
FROM Products
```

Здесь добавляемые значения фактически представляют результат выборки из таблицы Products.

---

### Изучение сортировки данных

Сортировка данных выполняется с помощью команды ORDER BY, которая добавляется в конец запроса, 
после чего перечисляется список столбцов. 

Для каждого столбца указывается тип сортировки ASC | DESC (ascending – по возрастанию | descending – по убыванию).

ASC – по умолчанию, можно не указывать.

* Пример 6: Вывести список академиков, отсортированный по возрастанию года присвоения звания:

```sql
SELECT
*
FROM
Академики
ORDER BY
Год_присвоения_звания
```

* Пример 7: Вывести список академиков, отсортированный в обратном алфавитном порядке по полю «Специализация» 
  и в алфавитном порядке по полю «ФИО»:

```sql
SELECT
*
FROM
Академики
ORDER BY
Специализация DESC
,ФИО ASC
```

В качестве критерия сортировки также можно использовать сложное выражение на основе значений столбцов:

```sql
SELECT ProductName, Price, ProductCount
FROM Products
ORDER BY ProductCount * Price
```

---

### Изучение конструкции TOP

Конструкция TOP <N> позволяет выбрать определенное количество строк из таблицы.
Дополнительный оператор PERCENT позволяет выбрать процентное количество строк из таблицы. 

* Пример 8: Вывести первые две строки из списка академиков, отсортированного в алфавитном порядке по полю «ФИО»:

```sql
SELECT TOP 2
*
FROM
Академики
ORDER BY
ФИО ASC
```

* Пример 9: Вывести первые 30% строк из списка академиков, отсортированного по возрастанию года присвоения звания:

```sql
SELECT TOP 30 PERCENT
*
FROM
Академики
ORDER BY
Год_присвоения_звания
```

Дополнительный оператор WITH TIES позволяет выбрать все строки с такими же свойствами.

* Пример 10: Вывести из таблицы «Академики», отсортированной по возрастанию года присвоения звания, список академиков,
у которых год присвоения звания – один из первых четырех в отсортированной таблице:

```sql
SELECT TOP 4 WITH TIES
*
FROM
Академики
ORDER BY
Год_присвоения_звания
```

В случаи использования нескольких операторов, усекающих выборку, порядок применения команд к исходному набору будет следующим:

WHERE – если указано, то первым делом из всего набора строк таблицы идет отбор только удовлетворяющих условию записей
DISTINCT – если указано, то отбрасываются все дубликаты
ORDER BY – если указано, то делается сортировка результата
TOP – если указано, то из отсортированного результата возвращается только указанное число записей

Пример:
```sql
SELECT DISTINCT TOP 1
Salary FROM Employees WHERE DepartmentID=3 ORDER BY Salary
```

---

### Изучение конструкции OFFSET и FETCH

! Эти операторы применяются только в отсортированном наборе данных после выражения ORDER BY.

Конструкция OFFSET <N> ROWS указывает число строк, которые необходимо пропустить, 
прежде чем будет начат возврат строк из выражения запроса.

* Пример 11: Вывести, начиная с третьего, список академиков, отсортированный в алфавитном порядке ФИО:

```sql
SELECT
*
FROM
Академики
ORDER BY
ФИО
OFFSET 2 ROWS
```

Конструкция FETCH NEXT <N> ROWS ONLY указывает число строк, возвращаемых после обработки предложения OFFSET.
На языке T-SQL регистр не имеет значение (case insensitive). 

* Пример 12: Вывести, начиная с третьего и до десятого, список академиков, отсортированный в алфавитном порядке ФИО:

```sql
SELECT
*
FROM
Академики
ORDER BY
ФИО
OFFSET 2 ROWS
FETCH NEXT 8 ROWS ONLY
```

Вместо ключевого слова NEXT может быть указано слово FIRST, что в данном случае не имеет значения.
Затем так же указывается количество строк, которое надо получить.

Данная комбинация операторов, как правило, используется для постраничной навигации, 
когда необходимо получить определенную страницу с данными.

---
