---
Фильтрация данных: Лабораторная работа
---

[Таблица стран](assets/lab3/Страны.xlsx)

[К списку лабораторных >>>](../README.md)

---

### Задания по фильтрации таблицы со странами

1. Вывести названия и столицы пяти наибольших стран по площади.
2. Вывести список африканских стран, население которых не превышает 1 млн. чел.
3. Вывести список стран, население которых больше 5 млн. чел., а площадь меньше
   100 тыс. кв. км, и они расположены не в Европе.
4. Вывести список стран Северной и Южной Америки, население которых больше
   20 млн. чел., или стран Африки, у которых население больше 30 млн. чел.
5. Вывести список стран, население которых составляет от 10 до 100 млн. чел., а площадь не больше 500 тыс. кв. км.
6. Вывести список стран, названия которых не начинаются с буквы «К».
7. Вывести список стран, в названии которых третья буква – «а», а предпоследняя – «и».
8. Вывести список стран, в названии которых вторая буква – гласная.
9. Вывести список стран, названия которых начинаются с букв от «К» до «П».
10. Вывести список стран, названия которых начинаются с букв от «А» до «Г», но не с буквы «Б».
11. Вывести список стран, столицы которых есть в базе.
12. Вывести список стран Африки, Северной и Южной Америки.

---

### Фильтрация данных, WHERE

Для фильтрации данных применяется оператор WHERE. Синтаксис: 

```sql
WHERE <условие>
```

В условиях поле таблицы сравнивается с константой или с выражением.
Символьные константы пишутся в одинарных кавычках.
Числовые константы и названия столбцов пишутся без кавычек.
Чтобы строка попала в результат, условие должно быть истинно.

---


### Операции сравнения

В условиях используются операции сравнения. В Transact-SQL применяются следующие операции сравнения:

* = – равенство;
* <> или != – неравенство;
* \< – меньше;
* \> – больше;
* !< – не меньше;
* !> – не больше;
* <= – меньше или равно;
* \>= – больше или равно.

При сравнении строк регистр не имеет значение. В качестве условия могут использоваться и сложные выражения.

---


### Логические операторы

Можно использовать несколько условий для фильтрации данных. Для объединения их
в одно выражение используются логические операторы. В Transact-SQL применяются следующие логические операторы:

* AND – логическое умножение или конъюнкция (И).
  Бинарный оператор, объединяет два условия; если оба условия истинны, результат – истина, иначе – ложь.
* OR – логическое сложение или дизъюнкция (ИЛИ).
  Бинарный оператор, объединяет два условия; если хотя бы одно из этих условий истинно, то общее условие оператора OR
  также будет истинно.
* NOT – логическое отрицание или инверсия (НЕ).
  Унарный оператор, применяется к одному условию. Если выражение в этой операции ложно, то общее условие истинно.

Самый высокий приоритет у оператора NOT. Самый низкий – у OR.
Если эти операторы встречаются в одном выражении, то сначала выполняется NOT, потом AND, а затем OR.

При записи условий использование скобок – хороший тон программирования.

---


### Операторы фильтрации: BETWEEN, LiKE, NULL, IN и NOT IN

Оператор BETWEEN используется для сравнения с диапазоном от начального и до конечного значения.
Начальное и конечное значения включены в промежуток.

Если надо, наоборот, выбрать те строки, которые не попадают в данный диапазон, то применяется оператор NOT BETWEEN.

```sql
WHERE выражение [NOT] BETWEEN начальное_значение AND конечное_значение
```

Пример: Вывести список стран, которые находятся в Европе и их население больше 10 млн. чел.,
или находятся в Азии, а население больше 50 млн. чел.:

```sql
SELECT Название,Столица,Площадь,Население,Континент
FROM Страны
WHERE
(Континент = 'Европа') AND (Население > 10000000)
OR
(Континент = 'Азия') AND (Население > 50000000)
```

Оператор LIKE используется для сравнения с шаблоном строки. Для определения шаблона применяются специальные символы:

* % – любая последовательность символов, в том числе пустая;
* _ – любой символ;
* \[s] – символ(ы), который указан в квадратных скобках;
* \[ - ] – символ из определенного диапазона;
* \[ ^ ] – символ, который не указан после символа ^.

```sql
WHERE выражение [NOT] LIKE шаблон_строки
```

Некоторые примеры использования подстановок:

* WHERE ProductName LIKE 'Galaxy%'
  Соответствует таким значениям как "Galaxy Ace 2" или "Galaxy S7"

* WHERE ProductName LIKE 'Galaxy S_'
  Соответствует таким значениям как "Galaxy S7" или "Galaxy S8"

* WHERE ProductName LIKE 'iPhone [78]'
  Соответствует таким значениям как "iPhone 7" или "iPhone8"

* WHERE ProductName LIKE 'iPhone [6-8]'
  Соответствует таким значениям как "iPhone 6", "iPhone 7" или "iPhone8"

* WHERE ProductName LIKE 'iPhone [^7]%'
  Соответствует таким значениям как "iPhone 6", "iPhone 6S" или "iPhone8". Но не соответствует значениям "iPhone 7" и "iPhone 7S"

* WHERE ProductName LIKE 'iPhone [^1-6]%'
  Соответствует таким значениям как "iPhone 7", "iPhone 7S" и "iPhone 8". Но не соответствует значениям "iPhone 5", "iPhone 6" и "iPhone 6S"

Пример: Вывести список стран, в названии которых вторая буква – «а», а последняя – «я»:

```sql
SELECT Название,Столица,Площадь,Население,Континент
FROM Страны
WHERE Название LIKE '_а%я'
```

В базах данных, для обозначения неизвестного значения, используется понятие NULL.

Для проверки неизвестного значения нельзя использовать операторы сравнения. Допускается только IS NULL или IS NOT NULL.

```sql
SELECT * FROM Products
WHERE ProductCount IS NULL
```

Оператор IN используется для сравнения с набором значений. Список значений указывается в скобках.
Этот набор может вычисляться динамически на основании, например, еще одного запроса, либо это могут быть константные значения.

С помощью оператора NOT можно найти все строки, которые, наоборот, не соответствуют набору значений

```sql
WHERE выражение [NOT] IN (выражение)
```

Пример: Вывести список европейских, азиатских и африканских стран:

```sql
SELECT Название,Столица,Площадь,Население,Континент
FROM Страны
WHERE Континент IN ('Европа', 'Азия', 'Африка')
```

---

### [ESCAPE](http://www.sql-tutorial.ru/ru/book_predicate_like.html)

При помощи ESCAPE можно задать отменяющий символ, который отменяет проверяющее действие специальных символов (_«\_»_, «%», «\[», «\]» и др).
Этот управляющий символ должен использоваться в образце перед трафаретным символом, сообщая о том, что последний следует трактовать как обычный символ.
Например, если в некотором поле следует отыскать все значения, содержащие символ _«\_»_, то шаблон ‘%_%’ приведет к тому, 
что будут возвращены все записи из таблицы. В данном случае шаблон следует записать следующим образом:

```sql
'%#_%' ESCAPE '#'
```

Для проверки значения на соответствие строке «25%» можно воспользоваться таким предикатом:

```sql
LIKE '25|%' ESCAPE '|'
```

Следует заметить, что MySQL и PostgreSQL допускают помимо ESCAPE-символа экранирование трафаретных символов 
с помощью обратного слеша (\) в стиле некоторых языков программирования общего назначения.

---

